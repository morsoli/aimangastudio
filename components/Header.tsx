import React, { useState } from 'react';
import { MenuIcon, XIcon, BookOpenIcon, GlobeIcon, VideoIcon, ArrowLeftIcon, KeyIcon } from './icons';
import { useLocalization } from '../hooks/useLocalization';
import { Language } from '../i18n/locales';

interface HeaderProps {
    isSidebarOpen: boolean;
    onToggleSidebar: () => void;
    language: Language;
    setLanguage: (language: Language) => void;
    // Optional callback to open API Key modal/settings
    onOpenApiKeyModal?: () => void;
    hasApiKey?: boolean;
    onShowMangaViewer: () => void;
    onShowWorldview: () => void;
    currentView: 'manga-editor' | 'video-producer';
    onSetView: (view: 'manga-editor' | 'video-producer') => void;
}

export function Header({ isSidebarOpen, onToggleSidebar, language, setLanguage, onOpenApiKeyModal, hasApiKey, onShowMangaViewer, onShowWorldview, currentView, onSetView }: HeaderProps): React.ReactElement {
  const { t } = useLocalization();
  const [isLangOpen, setIsLangOpen] = useState(false);

  const languages: { key: Language, name: string }[] = [
      { key: 'zh', name: t('chinese') },
      { key: 'en', name: t('english') },
      { key: 'ja', name: t('japanese') },
  ];

  return (
    <header className="bg-white border-b border-gray-200 w-full z-20 relative">
      <div className="container mx-auto px-4 lg:px-6 py-3 flex justify-between items-center">
        <div className="flex items-center gap-3">
            {currentView === 'video-producer' ? (
                <button onClick={() => onSetView('manga-editor')} className="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-indigo-600 p-2 rounded-md hover:bg-gray-100" title={t('backToEditor')}>
                    <ArrowLeftIcon className="w-5 h-5" />
                    <span className="hidden md:inline">{t('backToEditor')}</span>
                </button>
            ) : (
                <button onClick={onToggleSidebar} className="p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    {isSidebarOpen ? <XIcon className="w-6 h-6 text-gray-700" /> : <MenuIcon className="w-6 h-6 text-gray-700" />}
                </button>
            )}

            <div className="w-10 h-10 rounded-lg flex items-center justify-center">
                {currentView === 'video-producer' 
                    ? <VideoIcon className="w-6 h-6 text-white" /> 
                    : <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                        width="1350.000000pt" height="1362.000000pt" viewBox="0 0 1350.000000 1362.000000"
                        preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,1362.000000) scale(0.100000,-0.100000)"
                        fill="#000000" stroke="none">
                        <path d="M8768 13489 c-10 -5 -18 -16 -18 -23 0 -20 -129 -194 -186 -251 -65
                        -65 -123 -85 -248 -85 -86 0 -183 11 -233 26 -20 5 -23 3 -23 -20 0 -20 9 -30
                        39 -44 81 -39 263 -195 302 -259 20 -33 21 -43 15 -211 -3 -97 -7 -190 -8
                        -207 -2 -21 2 -30 14 -33 11 -2 24 13 43 50 23 45 126 189 182 253 40 45 64
                        52 203 59 74 4 167 3 206 -2 122 -14 126 4 17 75 -106 69 -233 180 -261 228
                        -22 38 -22 47 -18 210 2 94 8 187 11 208 8 40 -2 47 -37 26z m-82 -371 c4 -18
                        7 -39 5 -46 -1 -8 15 -34 36 -60 43 -52 83 -123 83 -147 0 -17 -21 -20 -36 -5
                        -7 7 -18 2 -34 -15 -13 -14 -32 -25 -42 -25 -10 0 -37 -12 -60 -27 -65 -44
                        -82 -53 -102 -53 -14 0 -17 5 -13 23 4 15 -1 29 -17 44 -13 13 -27 40 -31 60
                        -3 21 -20 55 -37 76 -18 23 -31 52 -32 70 -1 30 1 32 34 33 38 0 120 38 133
                        60 4 8 16 14 26 14 9 0 26 7 37 15 29 22 42 18 50 -17z"/>
                        <path d="M6844 13111 c-51 -31 -74 -72 -74 -131 0 -31 7 -64 18 -82 22 -38 80
                        -68 133 -68 113 0 187 130 126 221 -50 75 -137 100 -203 60z"/>
                        <path d="M7678 12721 c-54 -34 -73 -70 -73 -136 0 -106 64 -161 177 -153 52 4
                        63 9 96 41 35 36 37 40 37 105 0 75 -18 109 -76 144 -38 23 -124 23 -161 -1z
                        m90 -139 c2 -7 -3 -12 -12 -12 -9 0 -16 7 -16 16 0 17 22 14 28 -4z"/>
                        <path d="M7050 12604 c-14 -7 -39 -14 -57 -14 -42 0 -63 -9 -63 -27 0 -7 11
                        -49 24 -91 26 -87 45 -158 57 -217 4 -22 12 -58 17 -80 6 -22 17 -85 26 -140
                        8 -55 21 -134 27 -175 20 -126 29 -263 35 -545 6 -270 -9 -537 -37 -635 -17
                        -57 -17 -165 0 -165 26 0 41 50 71 240 12 72 25 153 30 180 45 260 63 585 49
                        894 -6 113 -17 240 -25 281 -7 42 -14 90 -14 107 0 17 -5 44 -10 59 -6 15 -15
                        52 -20 83 -30 189 -40 242 -45 251 -8 13 -35 11 -65 -6z"/>
                        <path d="M8291 12143 c-92 -120 -134 -170 -212 -255 -130 -141 -131 -141 -375
                        -135 -149 3 -209 9 -239 20 -87 35 -124 6 -52 -40 23 -16 44 -30 47 -33 3 -3
                        25 -21 50 -39 114 -87 227 -214 264 -298 17 -39 18 -52 7 -165 -21 -228 -30
                        -294 -46 -332 -12 -28 -13 -41 -5 -51 18 -21 34 -9 81 61 24 35 47 64 51 64 4
                        0 14 13 22 28 8 15 61 75 118 133 94 97 108 107 157 119 36 9 84 11 145 6 50
                        -3 129 -9 176 -12 47 -3 103 -10 125 -16 22 -5 50 -12 63 -15 15 -4 22 -1 22
                        9 0 21 -18 39 -88 92 -83 63 -241 220 -278 275 l-29 45 2 175 c1 124 7 198 19
                        251 29 130 20 172 -25 113z m-136 -384 c4 -10 10 -19 14 -19 11 0 25 -58 22
                        -92 -1 -16 3 -28 8 -28 6 0 11 -9 11 -20 0 -29 38 -106 69 -139 27 -29 46 -61
                        56 -97 4 -17 -1 -23 -34 -32 -21 -7 -62 -12 -91 -12 -31 0 -70 -8 -94 -19 -23
                        -11 -55 -25 -73 -31 -18 -7 -35 -20 -38 -29 -7 -21 -92 -74 -109 -68 -9 4 -15
                        35 -20 94 -10 131 -38 202 -113 288 -65 75 -66 74 77 95 120 17 213 58 249
                        109 23 33 56 33 66 0z"/>
                        <path d="M8986 12098 c-8 -13 -20 -47 -26 -76 -7 -28 -16 -54 -21 -58 -5 -3
                        -9 -15 -9 -27 -1 -51 -59 -88 -165 -106 -38 -7 -82 -15 -97 -17 -16 -3 -28
                        -11 -28 -19 0 -14 68 -45 100 -45 11 0 49 -14 85 -31 46 -21 70 -40 81 -61 21
                        -40 44 -131 44 -173 0 -83 32 -87 55 -7 39 131 48 154 69 178 24 29 100 59
                        175 69 51 7 90 31 74 45 -4 4 -35 16 -68 25 -102 31 -164 65 -182 99 -9 17
                        -24 71 -34 120 -20 102 -30 119 -53 84z m26 -295 c15 -15 28 -32 28 -39 0 -23
                        -39 -42 -68 -35 -21 6 -28 14 -30 40 -2 23 2 37 15 47 24 18 23 18 55 -13z"/>
                        <path d="M6252 11881 c-56 -77 -194 -209 -227 -217 -45 -11 -257 3 -304 21
                        -48 17 -92 17 -98 -1 -2 -6 18 -26 44 -43 61 -40 178 -154 211 -206 23 -36 25
                        -48 23 -135 -2 -100 -3 -109 -28 -207 -15 -60 -13 -93 5 -93 5 0 28 24 49 53
                        59 77 177 192 216 211 31 14 52 15 164 7 70 -5 148 -17 172 -25 43 -16 81 -14
                        81 4 0 4 -22 24 -49 44 -83 61 -215 207 -229 253 -7 23 -10 47 -8 54 3 8 10
                        61 15 119 6 58 17 124 25 148 16 44 13 72 -8 72 -6 0 -30 -27 -54 -59z m-94
                        -290 c17 -10 42 -58 42 -80 0 -9 9 -35 20 -59 26 -56 18 -72 -34 -72 -28 0
                        -54 -9 -84 -29 -52 -34 -97 -32 -88 4 4 16 -3 31 -24 53 -18 19 -27 38 -24 47
                        4 8 1 21 -5 29 -22 26 18 78 75 98 53 19 101 23 122 9z"/>
                        <path d="M9856 11858 c-75 -72 -75 -144 0 -215 41 -39 49 -43 97 -43 53 0 79
                        12 128 58 20 20 24 32 24 85 0 50 -5 68 -23 92 -38 48 -72 65 -129 65 -48 0
                        -56 -4 -97 -42z"/>
                        <path d="M9573 11602 c-17 -15 -64 -49 -104 -77 -86 -59 -315 -231 -414 -310
                        -116 -93 -467 -418 -488 -453 -12 -19 -1 -42 20 -42 10 1 45 26 78 57 105 98
                        202 171 417 315 47 32 88 58 91 58 3 0 35 20 71 45 37 25 70 45 75 45 4 0 27
                        14 49 30 23 17 45 30 48 30 3 0 25 13 48 28 22 15 48 31 56 35 84 42 176 99
                        178 111 2 8 -8 32 -22 53 -14 21 -26 43 -26 49 0 6 -10 20 -23 32 l-22 21 -32
                        -27z"/>
                        <path d="M6457 11012 c-26 -26 -47 -50 -47 -54 0 -4 20 -26 45 -49 121 -111
                        229 -335 247 -509 2 -17 9 -25 23 -25 17 0 20 8 23 54 6 95 -50 325 -103 432
                        -40 78 -118 198 -130 198 -5 0 -31 -21 -58 -47z"/>
                        <path d="M8360 10674 c-6 -14 -10 -32 -10 -39 0 -24 -40 -123 -59 -146 -23
                        -28 -77 -46 -167 -54 -41 -4 -77 -12 -81 -18 -8 -13 37 -47 64 -47 29 0 119
                        -36 154 -61 36 -25 69 -99 69 -153 0 -83 52 -104 63 -26 3 23 18 67 34 98 23
                        47 36 61 76 80 26 13 77 26 113 29 35 3 67 10 70 14 11 18 -17 47 -48 52 -66
                        9 -167 53 -179 77 -27 55 -39 93 -39 130 0 71 -41 115 -60 64z m38 -292 c3 -9
                        -2 -13 -14 -10 -9 1 -19 9 -22 16 -3 9 2 13 14 10 9 -1 19 -9 22 -16z"/>
                        <path d="M9290 10653 c-91 -63 -101 -179 -23 -255 32 -31 38 -33 106 -33 56 0
                        78 4 98 20 86 65 77 207 -15 265 -43 26 -131 27 -166 3z"/>
                        <path d="M7905 10600 c-22 -11 -45 -19 -52 -20 -7 0 -27 -6 -45 -14 -18 -7
                        -58 -21 -88 -30 -30 -9 -71 -23 -90 -30 -80 -31 -127 -50 -157 -62 -17 -8 -34
                        -14 -37 -14 -10 0 -268 -129 -301 -150 -16 -11 -39 -24 -50 -30 -43 -22 -273
                        -177 -290 -196 -5 -6 -30 -26 -55 -44 -115 -87 -234 -198 -288 -270 -15 -19
                        -35 -44 -44 -54 -13 -14 -15 -23 -7 -32 19 -23 0 -73 -34 -90 -32 -16 -117
                        -101 -117 -117 0 -5 -4 -5 -10 -2 -5 3 -10 24 -10 45 0 21 5 42 10 45 6 3 10
                        20 10 36 0 17 4 38 9 47 18 36 21 88 7 107 -14 20 -15 20 -22 0 -4 -11 -22
                        -40 -38 -65 -31 -44 -66 -113 -144 -280 -86 -185 -102 -220 -102 -229 0 -7
                        -24 -67 -76 -189 -8 -18 -14 -39 -14 -47 0 -8 -6 -29 -14 -47 -33 -78 -70
                        -235 -95 -398 -25 -162 -27 -245 -6 -253 19 -8 28 8 36 63 10 67 29 161 39
                        195 22 73 51 157 59 173 4 9 23 49 41 87 66 143 144 290 166 316 8 8 14 19 14
                        23 0 5 14 25 30 46 17 21 30 41 30 45 0 4 29 46 66 93 145 193 419 469 577
                        581 26 19 47 38 47 43 0 4 6 8 14 8 8 0 16 4 18 9 5 14 238 175 359 249 81 49
                        92 58 85 79 -9 30 66 93 110 93 10 0 26 8 36 17 16 14 23 15 39 5 11 -7 24
                        -10 29 -7 6 4 10 1 10 -4 0 -6 -5 -11 -10 -11 -6 0 -16 -12 -23 -27 -11 -24
                        -130 -153 -141 -153 -3 0 -6 10 -8 22 -4 31 -24 33 -32 4 -3 -13 -23 -42 -44
                        -64 -34 -35 -142 -185 -142 -197 0 -3 -19 -35 -41 -72 -23 -38 -59 -104 -81
                        -148 -21 -44 -43 -87 -47 -95 -32 -56 -114 -291 -145 -415 -26 -102 -46 -272
                        -56 -465 -6 -102 -11 -196 -12 -210 -4 -34 41 -43 49 -10 10 39 99 205 150
                        280 26 39 53 81 60 94 7 12 24 35 38 50 14 15 33 40 43 54 35 57 194 262 287
                        372 53 63 101 125 107 136 6 12 22 27 35 33 23 11 24 13 10 29 -14 16 -12 22
                        25 77 74 111 92 120 101 51 5 -35 1 -57 -19 -103 -31 -71 -28 -67 -53 -53 -17
                        9 -21 8 -21 -5 0 -9 -9 -33 -19 -53 -29 -58 -43 -102 -70 -222 -19 -89 -50
                        -387 -71 -695 -5 -66 -13 -149 -20 -185 -38 -221 -53 -296 -60 -305 -4 -5 -10
                        -21 -13 -35 -16 -74 -103 -264 -147 -320 -15 -19 -29 -42 -32 -50 -20 -52
                        -202 -233 -348 -346 -41 -32 -81 -64 -88 -71 -7 -7 -22 -13 -33 -13 -12 0 -19
                        -7 -19 -20 0 -32 -30 -70 -54 -70 -13 0 -33 -11 -46 -25 -18 -19 -33 -25 -54
                        -23 -48 5 -53 28 -15 72 39 43 77 66 113 66 17 0 31 10 45 34 12 19 28 36 36
                        40 12 4 40 42 82 111 26 44 76 151 90 194 48 151 81 433 54 465 -18 22 -41 8
                        -41 -24 0 -28 -8 -70 -37 -205 -33 -149 -171 -386 -290 -496 -53 -49 -168
                        -139 -178 -139 -3 0 -21 -11 -38 -24 -44 -33 -161 -93 -196 -101 -21 -4 -44 2
                        -87 23 -33 17 -84 42 -114 57 -30 14 -75 37 -100 49 -25 13 -98 49 -162 80
                        -81 39 -125 67 -142 89 -31 41 -98 166 -126 237 -12 30 -28 69 -35 85 -14 31
                        -34 103 -55 190 -12 49 -23 132 -36 283 -7 72 6 221 27 332 6 30 15 77 20 104
                        4 27 13 54 19 60 5 5 10 19 10 31 0 11 7 29 15 39 8 11 15 26 15 33 0 7 16 45
                        35 85 38 77 44 87 88 156 15 24 27 45 27 47 0 28 258 338 332 400 56 46 219
                        197 280 258 32 31 62 57 68 57 5 0 10 13 10 28 0 60 95 109 120 63 13 -26 13
                        -67 -2 -90 -6 -10 -8 -26 -5 -35 7 -18 27 -22 27 -6 0 6 16 33 35 60 19 27 35
                        52 35 54 0 3 20 34 45 70 25 37 45 68 45 70 0 8 76 115 114 160 32 39 37 49
                        25 57 -20 13 -35 11 -53 -6 -8 -8 -25 -20 -38 -25 -13 -6 -48 -25 -80 -43 -31
                        -18 -76 -43 -100 -56 -23 -13 -62 -36 -86 -52 -24 -16 -45 -29 -47 -29 -6 0
                        -168 -114 -240 -168 -260 -198 -531 -491 -678 -734 -26 -43 -47 -81 -47 -85 0
                        -3 -6 -14 -14 -22 -12 -14 -54 -113 -108 -256 -31 -84 -56 -217 -69 -370 -18
                        -206 1 -401 57 -595 34 -115 89 -248 130 -312 35 -53 35 -68 4 -68 -60 0 -151
                        -66 -187 -137 -70 -134 -35 -291 77 -355 22 -13 40 -30 40 -39 0 -8 -17 -42
                        -38 -75 -21 -32 -47 -75 -58 -94 -10 -19 -38 -63 -61 -98 -24 -35 -43 -65 -43
                        -67 0 -7 -149 -226 -181 -266 -16 -20 -29 -40 -29 -43 0 -3 -26 -42 -57 -85
                        -32 -44 -94 -130 -138 -191 -73 -103 -420 -575 -448 -610 -7 -8 -35 -46 -62
                        -85 -27 -38 -75 -103 -107 -142 -32 -40 -58 -75 -58 -78 0 -3 -33 -50 -73
                        -103 -72 -95 -287 -409 -287 -419 0 -3 -13 -22 -30 -43 -17 -21 -30 -41 -30
                        -44 0 -4 -12 -25 -27 -49 -15 -23 -32 -50 -38 -59 -5 -10 -42 -71 -82 -135
                        -80 -132 -124 -210 -184 -328 -22 -44 -44 -87 -49 -95 -5 -8 -18 -35 -28 -60
                        -11 -25 -37 -80 -57 -124 -33 -71 -49 -113 -75 -186 -5 -14 -18 -50 -30 -80
                        -12 -30 -24 -66 -27 -80 -3 -14 -9 -30 -14 -35 -4 -6 -13 -31 -19 -55 -5 -25
                        -19 -76 -31 -115 -11 -38 -24 -90 -29 -115 -5 -25 -13 -63 -18 -85 -29 -118
                        -55 -360 -50 -462 l3 -55 -70 -37 c-39 -20 -100 -49 -135 -64 -36 -15 -73 -32
                        -82 -37 -26 -14 -141 -51 -283 -89 -90 -25 -193 -41 -300 -47 -116 -7 -132
                        -14 -119 -49 8 -20 91 -20 318 0 271 23 488 66 638 126 25 10 77 30 116 44 38
                        14 112 47 164 74 126 65 137 71 179 104 20 15 40 27 44 27 10 0 141 92 220
                        155 39 31 86 68 105 83 130 102 440 419 606 618 49 60 238 312 280 374 17 25
                        52 75 77 113 26 37 47 69 47 71 0 3 21 35 47 73 53 77 193 309 193 320 0 3 6
                        14 14 22 8 9 30 45 49 81 18 36 44 82 56 102 32 53 95 174 206 398 53 107 106
                        213 118 235 22 43 26 51 49 105 8 19 24 55 36 80 53 118 75 167 86 195 16 37
                        72 160 92 198 8 16 14 35 14 42 0 7 11 36 25 64 14 28 44 99 66 158 22 60 45
                        112 50 118 5 5 9 18 9 28 0 10 6 31 14 45 8 15 19 41 24 57 6 17 24 68 42 115
                        58 158 100 290 100 315 0 31 21 32 80 4 64 -31 106 -34 174 -11 74 25 146 86
                        177 149 30 61 34 184 6 226 -28 43 -23 67 16 68 50 1 159 23 184 37 12 6 29
                        12 37 12 8 0 32 7 53 16 21 9 53 23 71 30 17 8 49 22 70 31 45 21 205 114 212
                        123 3 3 26 21 52 38 57 39 196 178 259 258 50 65 109 152 109 161 0 3 13 27
                        28 52 15 25 38 71 51 101 12 30 26 64 30 75 5 11 14 34 21 50 46 113 95 407
                        111 669 5 82 11 157 14 167 4 10 10 73 15 141 10 132 32 299 50 382 22 99 67
                        258 86 304 8 18 14 37 14 43 0 21 127 266 173 337 26 39 61 82 77 96 33 28 45
                        72 19 70 -20 -2 -167 -98 -289 -190 -226 -171 -491 -453 -641 -684 -61 -94
                        -119 -198 -119 -214 0 -15 -28 -36 -48 -36 -18 0 -22 32 -8 58 8 15 31 68 52
                        117 20 50 51 122 69 160 18 39 45 97 59 130 15 33 34 74 43 90 9 17 34 64 56
                        105 34 65 57 105 115 195 6 11 15 27 19 35 4 8 36 56 72 105 37 50 79 108 94
                        131 73 108 296 340 400 416 37 28 66 55 64 62 -6 19 -50 17 -92 -4z m-2464
                        -3405 c44 -24 51 -28 119 -59 19 -9 42 -20 50 -26 29 -17 386 -190 394 -190 4
                        0 36 -19 71 -41 48 -32 65 -50 75 -79 14 -43 6 -65 -43 -117 -41 -43 -79 -43
                        -165 1 -119 60 -164 82 -387 192 -121 59 -234 119 -252 132 -72 53 -61 134 27
                        195 33 23 59 21 111 -8z m816 -221 c2 -6 -13 -24 -32 -39 -27 -20 -40 -24 -48
                        -16 -8 8 -3 19 18 41 29 30 55 36 62 14z m-820 -230 c47 -32 237 -124 255
                        -124 18 0 38 -20 38 -38 0 -8 -8 -33 -19 -56 -36 -80 -51 -117 -51 -127 0 -6
                        -6 -25 -14 -42 -14 -35 -40 -100 -62 -159 -34 -92 -47 -125 -61 -158 -39 -91
                        -45 -105 -89 -222 -9 -24 -20 -50 -24 -59 -4 -8 -34 -76 -65 -149 -61 -143
                        -64 -148 -89 -197 -9 -17 -16 -36 -16 -41 0 -5 -25 -63 -56 -128 -104 -221
                        -185 -389 -194 -404 -5 -8 -34 -64 -65 -125 -31 -60 -77 -149 -103 -197 -26
                        -49 -65 -121 -86 -160 -21 -40 -50 -91 -64 -113 -14 -22 -36 -58 -48 -80 -28
                        -52 -49 -88 -104 -175 -25 -39 -52 -82 -60 -95 -45 -71 -219 -324 -241 -350
                        -14 -16 -35 -46 -47 -65 -11 -19 -29 -44 -39 -55 -10 -11 -43 -51 -73 -90
                        -259 -334 -611 -661 -922 -859 -51 -32 -109 -70 -129 -83 -19 -12 -43 -23 -53
                        -23 -16 0 -18 5 -12 38 4 20 11 82 16 137 9 100 32 243 49 300 18 61 39 131
                        56 190 10 33 24 75 31 93 8 18 14 39 14 47 0 7 8 28 17 47 9 18 22 45 30 60 7
                        14 13 35 13 45 0 11 7 28 15 39 8 10 15 25 15 32 0 27 204 440 229 465 6 6 11
                        17 11 23 0 7 12 32 28 56 44 69 51 82 62 103 6 11 18 32 28 47 9 14 30 48 46
                        75 57 95 321 489 378 565 32 42 58 79 58 82 0 3 112 156 248 338 212 284 349
                        471 442 603 18 26 90 125 212 295 197 274 418 638 418 689 0 39 25 40 77 5z
                        m-2519 -4429 c3 -26 -17 -55 -39 -55 -16 0 -17 56 -1 73 21 23 36 17 40 -18z"/>
                        <path d="M3548 3629 c-114 -27 -198 -135 -198 -256 0 -122 70 -210 193 -245
                        59 -17 65 -17 117 -1 107 33 165 96 190 206 8 38 7 60 -5 109 -29 110 -78 162
                        -177 186 -53 14 -68 14 -120 1z m137 -152 c90 -93 21 -244 -102 -221 -40 8
                        -100 62 -109 100 -12 47 42 134 91 147 37 10 98 -3 120 -26z"/>
                        <path d="M8850 9915 c-8 -2 -62 -8 -120 -15 -89 -9 -210 -29 -285 -46 -178
                        -41 -383 -107 -397 -128 -4 -6 -8 -19 -8 -30 0 -21 17 -20 110 9 93 28 220 54
                        330 67 242 29 723 6 915 -44 22 -5 54 -11 70 -11 l30 -2 8 84 c4 47 4 88 0 92
                        -20 17 -581 38 -653 24z"/>
                        <path d="M9810 9896 c-47 -17 -100 -87 -100 -132 0 -91 64 -158 150 -158 123
                        0 191 129 122 229 -43 62 -108 85 -172 61z"/>
                        </g>
                        </svg>
                }
            </div>
            <h1 className="text-xl font-bold text-gray-800 tracking-tight">
                {currentView === 'video-producer' ? t('aiVideoProducer') : t('AIMangaStudio')}
            </h1>
        </div>
        <div className="flex items-center gap-4">
            {currentView === 'manga-editor' && (
                <>
                    <button onClick={() => onSetView('video-producer')} className="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-indigo-600 p-2 rounded-md hover:bg-gray-100" title={t('aiVideoProducer')}>
                        <VideoIcon className="h-5 w-5" />
                    </button>
                     <button onClick={onShowMangaViewer} className="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-indigo-600 p-2 rounded-md hover:bg-gray-100" title={t('viewCollection')}>
                        <BookOpenIcon className="h-5 w-5" />
                    </button>
                    <button onClick={onShowWorldview} className="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-indigo-600 p-2 rounded-md hover:bg-gray-100" title={t('worldviewSettings')}>
                        <GlobeIcon className="h-5 w-5" />
                    </button>
                </>
            )}

            {/* {<div className="relative">
                 <button
                    onClick={() => setIsLangOpen(prev => !prev)}
                    className="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-indigo-600 p-2 rounded-md hover:bg-gray-100"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M7 2a1 1 0 011.707-.707l3.586 3.586a1 1 0 010 1.414l-3.586 3.586A1 1 0 017 9V5a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h2a1 1 0 001-1v-4a1 1 0 011-1h2.586l3.707 3.707a1 1 0 01-1.414 1.414L10 14.414V18a1 1 0 01-1 1H7a1 1 0 01-1-1v-2a1 1 0 00-1-1H4a1 1 0 00-1 1v2a3 3 0 003 3h4a1 1 0 00.707-1.707L10 18.586V14.5a1 1 0 011-1h1.293l4.293 4.293a1 1 0 001.414-1.414L14.414 13H16a3 3 0 003-3V7a3 3 0 00-3-3h-4a1 1 0 00-1 1v2.586L9.707 2.293A1 1 0 019 2H7z" clipRule="evenodd" /></svg>
                    <span>{languages.find(l => l.key === language)?.name}</span>
                </button>
                {isLangOpen && (
                    <div className="absolute top-full right-0 mt-2 w-36 bg-white border border-gray-200 rounded-md shadow-lg z-30">
                        {languages.map(({ key, name }) => (
                            <div key={key} onClick={() => { setLanguage(key); setIsLangOpen(false); }} className={`px-4 py-2 text-sm hover:bg-indigo-50 cursor-pointer ${language === key ? 'font-bold text-indigo-600' : 'text-gray-700'}`}>
                                {name}
                            </div>
                        ))}
                    </div>
                )}
            </div> } */}

            {/* API Key settings button (visible when callback provided) */}
            {typeof onOpenApiKeyModal === 'function' && (
                <button
                    onClick={onOpenApiKeyModal}
                    className="relative flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-indigo-600 p-2 rounded-md hover:bg-gray-100"
                    title={t('apiKeySettings')}
                    aria-label={t('apiKeySettings')}
                >
                    <KeyIcon className="h-5 w-5" />
                    {hasApiKey && (
                        <span className="absolute -top-1 -right-1 inline-flex items-center justify-center h-3 w-3 rounded-full bg-green-500 ring-2 ring-white" aria-hidden="true"></span>
                    )}
                </button>
            )}

            <button className="bg-indigo-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-indigo-500 transition-colors text-sm">
              {t('export')}
            </button>
        </div>
      </div>
    </header>
  );
}
